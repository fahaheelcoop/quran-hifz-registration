<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>مسابقة حفظ القرآن الكريم 2026</title>

<style>
  *{box-sizing:border-box}
  body{font-family:Arial,sans-serif;background:#f6f7fb;margin:0;padding:40px}
  .card{max-width:520px;margin:auto;background:#fff;padding:28px;border-radius:16px;box-shadow:0 10px 30px rgba(0,0,0,.08)}
  h2{text-align:center;margin:0 0 18px}
  label{display:block;margin:14px 0 6px;font-weight:700}
  input{width:100%;padding:11px;border-radius:10px;border:1px solid #d8d8d8}
  button{width:100%;margin-top:18px;padding:13px 16px;background:#2e7d32;color:#fff;border:0;border-radius:12px;cursor:pointer;font-size:16px}
  button:hover{background:#256628}
  .msg{margin-top:12px;text-align:center}
  .err{color:#b00020}
  .ok{color:#1b5e20}
  .small{color:#666;font-size:13px;margin-top:8px;text-align:center}
</style>
</head>

<body>
<div class="card">
  <h2>التسجيل في مسابقة حفظ القرآن الكريم</h2>

  <label>الرقم المدني (ولي الأمر)</label>
  <input type="text" id="civil_id" inputmode="numeric" placeholder="مثال: 123456789012" />

  <label>رقم الصندوق</label>
  <input type="text" id="box_number" inputmode="numeric" placeholder="مثال: 1234" />

  <button id="btn" onclick="checkAllowed()">تحقق وابدأ التسجيل</button>

  <div class="msg" id="msg"></div>
  <div class="small">سيتم السماح فقط للأرقام الموجودة ضمن المسموح لهم.</div>
</div>

<script>
const API_URL = "https://script.google.com/macros/s/AKfycbyo4zs3v4Qno0j_p5N-8qV2WR-HFG63nlrWR-F773WKLjj3cnDAg94zu9vVOMYvTngJ/exec";

function digits(x){ return String(x||"").replace(/\D+/g,""); }

async function checkAllowed(){
  const btn = document.getElementById('btn');
  const msg = document.getElementById('msg');
  msg.textContent = '';
  msg.className = 'msg';

  const guardian_civil_id = digits(document.getElementById('civil_id').value);
  const box_number = digits(document.getElementById('box_number').value);

  if(guardian_civil_id.length < 8 || box_number.length < 1){
    msg.textContent = "من فضلك أدخل رقم مدني ورقم صندوق صحيحين.";
    msg.classList.add('err');
    return;
  }

  btn.disabled = true;
  btn.textContent = "جارٍ التحقق...";

  try{
    const res = await fetch(API_URL, {
      method: "POST",
      headers: {"Content-Type":"application/json"},
      body: JSON.stringify({ action:"checkAllowed", guardian_civil_id, box_number })
    });
    const data = await res.json();

    if(data && data.ok){
      msg.textContent = "تم التحقق بنجاح ✅ سيتم تحويلك للتسجيل الآن...";
      msg.classList.add('ok');

      // تحويل لصفحة التسجيل مع تمرير البيانات
      const q = new URLSearchParams({
        guardian_civil_id,
        box_number,
        guardian_name: data.guardian_name || ""
      });
      window.location.href = "register.html?" + q.toString();
    }else{
      msg.textContent = (data && data.error) ? data.error : "تعذر التحقق.";
      msg.classList.add('err');
    }
  }catch(e){
    msg.textContent = "حصل خطأ في الاتصال. جرّب مرة أخرى.";
    msg.classList.add('err');
  }finally{
    btn.disabled = false;
    btn.textContent = "تحقق وابدأ التسجيل";
  }
}
</script>
</body>
</html>
